
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">

<!--
	Copyright (c) 1999-2011 by Digital Mars
	All Rights Reserved Written by Walter Bright
	http://www.digitalmars.com
  -->

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>Migrating D1 Code to D2 - D Programming Language</title>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<link rel="shortcut icon" href="favicon.ico" />

<script src="/js/hyphenate_selectively.js" type="text/javascript"></script>

<script type="text/javascript">
function bodyLoad()
{
	var links = document.getElementById("navigation").getElementsByTagName("a");
	for (var i = 0; i < links.length; i++)
	{
		var url = "/" + links[i].getAttribute("href");
		if (window.location.href.match(url + "\x24") == url)
		{
			var cls = links[i].getAttribute("class");
			links[i].setAttribute("class", cls ? cls + " active" : "active");
			break;
		}
	}
}
</script>
</head>

<body onLoad='bodyLoad()' class='hyphenate'>

<div id="top">
	<div id="search-box">
		<form method="get" action="http://google.com/search">
			<img src="images/search-left.gif" width="11" height="22" /><input id="q" name="q" /><input type="image" id="search-submit" name="submit" src="images/search-button.gif" />
			<input type="hidden" id="domains" name="domains" value="d-programming-language.org" />
			<input type="hidden" id="sourceid" name="sourceid" value="google-search" />
			<div id="search-dropdown">
				<select id="sitesearch" name="sitesearch" size="1">
					<option value="d-programming-language.org">Entire D Site</option>
					<option value="d-programming-language.org/phobos">Library Reference</option>
					<option value="www.digitalmars.com/d/archives">Newsgroup Archives</option>
				</select>
			</div>
		</form>
	</div>
	<div id="header">
		<a href="/"><img id="logo" width="125" height="95" border="0" alt="D Logo" src="images/dlogo.png"></a>
		<a id="d-language" href="/">D Programming Language</a>
	</div>
</div>

<!-- Generated by Ddoc from D1toD2.dd -->



<div id="navigation">
  

<div class="navblock">
<h2><a href="index.html" title="D Programming Language">D Home</a></h2>
<ul><li><a href="overview.html" title="D language overview">Overview</a></li>
	<li><a href="comparison.html" title="D feature list">Features</a></li>
	<li><a href="download.html" title="Download a D compiler">Downloads &amp; Tools</a></li>
	<li><a href="faq.html" title="Frequently Asked Questions">FAQ</a></li>
	<li><a href="appendices.html">Appendices</a></li>
	<li><a href="acknowledgements.html" title="Thank-you to these people who have helped with D">Acknowledgements</a></li>
	<li><a href="http://www.digitalmars.com/d/1.0/index.html" title="D Programming Language 1.0">D1 Home</a></li>
</ul>
    </div>

<div class="navblock">
<h2>Documentation</h2>
<ul><li><a href="language-reference.html">Language Reference</a></li>
	<li><a href="phobos/index.html">Library Reference</a></li>
	<li><a href="howtos.html" title="Helps for using D">Howtos</a></li>
	<li><a href="articles.html">Articles</a></li>
</ul>
    </div>

<div class="navblock">
<h2>Community</h2>
<ul><li><a href="http://digitalmars.com/NewsGroup.html" title="User forums">Forums</a></li>
	<li><a href="http://github.com/D-Programming-Language" title="D on github">Github</a></li>
	<li><a href="http://prowiki.org/wiki4d/wiki.cgi?FrontPage" title="Wiki for the D Programming Language">Wiki</a></li>
	<li><a href="http://dsource.org/" title="D projects and libraries at dsource.org">Projects &amp; Libraries</a></li>
	<li><a href="http://twitter.com/#search?q=%23d_lang" title="#d_lang on twitter.com">Twitter</a></li>
	<li><a href="http://digitalmars.com/d/dlinks.html" title="External D related links">Links</a></li>
	
	
</ul>
    </div>
  
<div id="translate" class="tool"><script type="text/javascript">document.write("Translate this page:")</script>
	<div id="google_translate_element"></div><script type="text/javascript">
	function googleTranslateElementInit() {
	  new google.translate.TranslateElement({
	    pageLanguage: 'en',
	    autoDisplay: false,
	    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
	  }, 'google_translate_element');
	}
	</script><script type="text/javascript" src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</div>
</div>
<div id="content">
  
<div id="tools">
	<span id="lastupdate">Last update Tue Sep 20 23:56:48 2011
</span>
	<span id="wiki"><a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/D1toD2">Comment on this page</a></span>
</div>
  <h1>Migrating D1 Code to D2</h1>
  	<p>There are many changes to the D programming language that affect
	migrating source code from D1 to D2.
	This is an outline of changes to look for and a guide to how to modify
	the code.
	See <a href="features2.html">D 2.0 Enhancements</a> for a complete list
	of changes to the language.
	</p>

	<p>This document is incomplete.</p>

<ul>   <li>Core Language
    <ul><li><a href="#new_keywords">New Keywords</a></li>
	<li><a href="#global_variables">Global Variables</a></li>
	<li><a href="#static_arrays">Static Arrays are now Value Types</a></li>
	<li><a href="#immutable_string">String Literals are Immutable</a></li>
    </ul>
    </li>

    <li>Phobos Library
    <ul>   </ul>
    </li>
</ul>

<hr><h3><a name="new_keywords">New Keywords</a></h3>

	<p>D2 adds the following keywords:
	<span class="d_keyword">pure</span>
	<span class="d_keyword">nothrow</span>
	<span class="d_keyword">shared</span>
	<span class="d_keyword">immutable</span>
	Any use of them in D1 code must be renamed.
	Any variable names starting with two underscores
	should be renamed.
	</p>

<hr><h3><a name="global_variables">Global Variables</a></h3>

	<p>Global variables are now, by default, stored in thread local
	storage. To put them back in global storage, use the <span class="d_keyword">__gshared</span>
	storage class:</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo = 7; <span class="d_comment">// D1 code
</span><b><span class="d_keyword">__gshared</span></b> <span class="d_keyword">int</span> foo = 7; <span class="d_comment">// D2 equivalent
</span></span></pre>

	<p>Carefully consider whether or not those variables actually should
	go into thread local storage, rather than being implicitly shared
	among all threads.
	</p>

<hr><h3><a name="static_arrays">Static Arrays are now Value Types</a></h3>

	<p>In D1, a static array function parameter is passed by
	reference, meaning a pointer to the start of the static array
	is passed as an argument.
	This means that any changes to the array contents made by the
	function will be visible to the function's caller.
	In D2, a copy of the whole static
	array is passed as an argument. Changes to the array contents by
	the function are not visible to the function's caller, as it is
	a separate copy.</p>

	<p>To migrate, add the keyword <span class="d_keyword">ref</span> to the parameter
	declaration:</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">void</span> foo(<span class="d_keyword">int</span>[3] array);      <span class="d_comment">// D1 code
</span><span class="d_keyword">void</span> foo(<b><span class="d_keyword">ref</span></b> <span class="d_keyword">int</span>[3] array);  <span class="d_comment">// D2 equivalent
</span></span></pre>

<hr><h3><a name="immutable_string">String Literals are Immutable</a></h3>

	<p>String literals in D1 have type <pre class="d_code"><span class="notranslate">char[]</span></pre>, but in
	D2 they have type <pre class="d_code"><span class="notranslate">immutable(char)[]</span></pre>.
	To migrate usually involves doing a global search replace:
	</p>

	<table border=1 cellpadding=4 cellspacing=0><tr><th scope="col">from</th><th scope="col">to</th></tr>
	<tr><td>char[]</td><td>string</td></tr>
	<tr><td>wchar[]</td><td>wstring</td></tr>
	<tr><td>dchar[]</td><td>dstring</td></tr>
	</table>

	<p>This will take care of most of the issues.
	For the rest, where mutable strings are desired, there will
	be some work necessary.
	</p>


  
<div id="google_ad">
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
</div>



<div id="footernav">
<a href="http://www.digitalmars.com/NewsGroup.html" title="User Forums">Forums</a> |
<a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/D1toD2" title="Read/write comments and feedback">Comments</a> |
<a href="index.html" title="D Programming Language" class="dlink">&nbsp;D&nbsp;</a> |
<a href="http://www.digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a> |
<a href="download.html" title="Download D">Downloads</a> |
<a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a>
</div>
<div id="copyright">

Copyright &copy; 1999-2011 by Digital Mars &reg;, All Rights Reserved |
Page generated by <a href="ddoc.html">Ddoc</a>.
</div>
</body>
</html>
