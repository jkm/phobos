
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">

<!--
	Copyright (c) 1999-2011 by Digital Mars
	All Rights Reserved Written by Walter Bright
	http://www.digitalmars.com
  -->

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>Warnings - D Programming Language 2.0 - Digital Mars</title>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<link rel="shortcut icon" href="favicon.ico" />

<script src="/js/hyphenate_selectively.js" type="text/javascript"></script>

<script type="text/javascript">
function bodyLoad()
{
	var links = document.getElementById("navigation").getElementsByTagName("a");
	for (var i = 0; i < links.length; i++)
	{
		var url = "/" + links[i].getAttribute("href");
		if (window.location.href.match(url + "\x24") == url)
		{
			var cls = links[i].getAttribute("class");
			links[i].setAttribute("class", cls ? cls + " active" : "active");
			break;
		}
	}
}
</script>
</head>

<body onLoad='bodyLoad()' class='hyphenate'>

<div id="top">
	<div id="search-box">
		<form method="get" action="http://google.com/search">
			<img src="/images/search-left.gif" width="11" height="22" /><input id="q" name="q" /><input type="image" id="search-submit" name="submit" src="/images/search-button.gif" />
			<input type="hidden" id="domains" name="domains" value="d-programming-language.org" />
			<input type="hidden" id="sourceid" name="sourceid" value="google-search" />
			<div id="search-dropdown">
				<select id="sitesearch" name="sitesearch" size="1">
					<option value="d-programming-language.org">Entire D 2.0 Site</option>
					<option value="d-programming-language.org/phobos">Library Reference</option>
					<option value="www.digitalmars.com/d/archives">Newsgroup Archives</option>
				</select>
			</div>
		</form>
	</div>
	<div id="header">
		<a href="/"><img id="logo" width="125" height="95" border="0" alt="D Logo" src="/images/dlogo.png"></a>
		<a id="d-language" href="/">D Programming Language 2.0</a>
	</div>
</div>

<!-- Generated by Ddoc from warnings.dd -->



<div id="navigation">
  

<div class="navblock">
<h2><a href="index.html" title="D Programming Language">D 2.0 Home</a></h2>
<ul><li><a href="overview.html" title="D language overview">Overview</a>

    <div class="navblock">
<ul><li><a href="wc.html" title="wc - the wordcount program">Example: wc</a></li>
	<li><a href="warnings.html" title="Explanation of D compiler generated warning messages">Warnings</a></li>
	<li><a href="builtin.html">   Rationale for Builtins</a></li>
	<li><a href="ctod.html">      Converting C to D</a></li>
	<li><a href="cpptod.html">    Converting C++ to D</a></li>
	<li><a href="pretod.html">The C Preprocessor vs D</a></li>
	<li><a href="template-comparison.html">D templates compared</a></li>
	<li><a href="cppstrings.html">D strings vs C++ std::string</a></li>
	<li><a href="cppcomplex.html">D complex vs C++ std::complex</a></li>
	<li><a href="cppdbc.html">    D Contract Programming vs C++</a></li>
	<li><a href="lisp-java-d.html">Lisp vs. Java... D?</a></li>
	<li><a href="cpp0x.html">D and C++0x</a></li>
</ul>
</div></li>
	<li><a href="comparison.html" title="D feature list">Features</a></li>
	<li><a href="download.html" title="Download a D compiler">Downloads &amp; Tools</a></li>
	<li><a href="faq.html" title="Frequently Asked Questions">FAQ</a></li>
	<li><a href="appendices.html">Appendices</a></li>
	<li><a href="acknowledgements.html" title="Thank-you to these people who have helped with D">Acknowledgements</a></li>
	<li><a href="http://www.digitalmars.com/d/1.0/index.html" title="D Programming Language 1.0">D1 Home</a></li>
</ul>
    </div>

<div class="navblock">
<h2>Documentation</h2>
<ul><li><a href="language-reference.html">Language Reference</a></li>
	<li><a href="phobos/index.html">Library Reference</a></li>
	<li><a href="howtos.html" title="Helps for using D">Howtos</a></li>
	<li><a href="articles.html">Articles</a></li>
</ul>
    </div>

<div class="navblock">
<h2>Community</h2>
<ul><li><a href="http://www.digitalmars.com/NewsGroup.html" title="User forums">Forums</a></li>
	<li><a href="http://www.prowiki.org/wiki4d/wiki.cgi?FrontPage" title="Wiki for the D Programming Language">Wiki</a></li>
	<li><a href="http://www.dsource.org/" title="D projects and libraries at dsource.org">Projects &amp; Libraries</a></li>
	<li><a href="http://twitter.com/#search?q=%23d_lang" title="#d_lang on twitter.com">Twitter</a></li>
	<li><a href="http://www.digitalmars.com/d/dlinks.html" title="External D related links">Links</a></li>
	
	
</ul>
    </div>
  
<div id="translate" class="tool"><script type="text/javascript">document.write("Translate this page:")</script>
	<div id="google_translate_element"></div><script type="text/javascript">
	function googleTranslateElementInit() {
	  new google.translate.TranslateElement({
	    pageLanguage: 'en',
	    autoDisplay: false,
	    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
	  }, 'google_translate_element');
	}
	</script><script type="text/javascript" src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</div>
</div>
<div id="content">
  
<div id="tools">
	<span id="lastupdate">Last update Mon May 16 20:47:29 2011
</span>
	<span id="wiki"><a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/Warnings">Comment on this page</a></span>
</div>
  <h1>          Warnings</h1>
  	<p>Depending on one's point of view, warnings are either a symptom
	of broken language design or a useful &lsquo;lint&rsquo; like tool to analyze
	code and look for potential trouble spots.
	Most of the time, those trouble spots will be legitimate code
	intended to be that way. More rarely, it may indicate an
	unintentional error on the part of the programmer.
	</p>

	<p>Warnings are not a defined part of the D Programming Language.
	They exist at the discretion of the compiler vendor, and
	will most likely vary from vendor to vendor.
	All constructs for which an implementation may generate a warning
	message are legal D code.
	</p>

	<p>These are the warnings generated by the Digital Mars D compiler
	when the <b>-w</b> switch is thrown.
	Most have generated some spirited debate as to whether it should
	be a warning, an error, and what the correct way to write D code
	in these situations should be. Since no consensus emerged,
	they appear as optional warnings, with alternatives on how to
	write correct code.
	</p>

<h3>warning - implicit conversion of expression <i>expr</i> of type <i>type</i> to <i>type</i> can cause loss of data</h3>

	<p>D follows the C and C++ rules regarding default integral promotion
	in expressions. This is done for both compatibility reasons
	and because modern CPUs are designed to execute such semantics
	efficiently. These rules also include implicit narrowing rules,
	where the result of such can be cast back into a smaller type,
	perhaps losing significant bits in the process:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">byte</span> a,b,c;
...
a = b + c;
</span></pre>

	<p>The <i>b</i> and <i>c</i> are both promoted to type <b>int</b> using
	the default integral promotion rules. The result of the add is then
	also <b>int</b>. To be assigned to <i>a</i>, that <b>int</b> gets
	implicitly converted to a <b>byte</b>.
	</p>

	<p>Whether it is a bug or not in the program depends on if the values
	for <i>b</i> and <i>c</i> can possibly cause an overflow, and
	if that overflow matters or not to the algorithm.
	The warning can be resolved by:
	</p>

	<ol>	<li>Inserting a cast:
<pre class="d_code"><span class="notranslate">a = <span class="d_keyword">cast</span>(<span class="d_keyword">byte</span>)(b + c);
</span></pre>
	This eliminates the warning, but since casting is a blunt instrument
	that bypasses type checking, this can mask another bug that could
	be introduced if the types of <i>a</i>, <i>b</i> or <i>c</i>
	change in the future, or if their types are set by a template
	instantiation. (In generic code, the <tt>cast(byte)</tt> would
	probably be <tt>cast(typeof(a))</tt>).
	</li>

	<li>Changing the type of <i>a</i> to <b>int</b>.
	This is generally a better solution, but of course may not work
	if it must be a smaller type, which leads us to:
	</li>

	<li>Doing a runtime check for overflow:
<pre class="d_code"><span class="notranslate"><span class="d_keyword">byte</span> a,b,c;
<span class="d_keyword">int</span> tmp;
...
tmp = b + c;
<span class="d_keyword">assert</span>(<span class="d_keyword">cast</span>(<span class="d_keyword">byte</span>)tmp == tmp);
a = <span class="d_keyword">cast</span>(<span class="d_keyword">byte</span>)tmp;
</span></pre>
	This ensures that no significant bits get lost.
	</li>
	</ol>

	<p>Some proposed language solutions are:</p>

	<ol>	<li>Having the compiler automatically insert the equivalent of
	the option 3 runtime check.
	</li>

	<li>Add a new construct,
	<tt><b>implicit_cast</b>(<i>type</i>)<i>expression</i></tt>
	that is a restricted form of the general cast, and will only
	work where implicit casts would normally be allowed.
	</li>

	<li>Implement the <b>implicit_cast</b> as a template.
	</li>

	</ol>

<h3>warning - array 'length' hides other 'length' name in outer scope</h3>

	<p>Inside the [ ] of an array indexing expression or slice, the
	variable <i>length</i> gets defined and set to be the length
	of that array. The scope of the <i>length</i> is from the opening
	&lsquo;[&rsquo; to the closing &lsquo;]&rsquo;.
	</p>

	<p>If <i>length</i> was declared as a variable name
	in an outer scope, that version may have been intended for
	use between the [ ]. For example:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">char</span>[10] a;
<span class="d_keyword">int</span> length = 4;
...
<span class="d_keyword">return</span> a[length - 1];	<span class="d_comment">// returns a[9], not a[3]
</span></span></pre>

	<p>The warning can be resolved by:</p>

	<ol>	<li>Renaming the outer <i>length</i> to another name.
	</li>

	<li>Replacing the use of <i>length</i> within the [ ]
	with <i>a.length</i>.
	</li>

	<li>If <i>length</i> is at global or class scope, and that was the
	one intended to be used, use <i>.length</i> or <i>this.length</i>
	to disambiguate.
	</li>
	</ol>

	<p>Some proposed language solutions are:</p>

	<ol>	<li>Make the <i>length</i> a special symbol or a keyword instead
	of an implicitly declared variable.
	</li>
	</ol>

<h3>warning - no return at end of function</h3>

	<p>Consider the following:</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> k, Collection c)
{
    <span class="d_keyword">foreach</span> (<span class="d_keyword">int</span> x; c)
    {
	<span class="d_keyword">if</span> (x == k)
	    <span class="d_keyword">return</span> x + 1;
    }
}
</span></pre>

	<p>and assume that the nature of the algorithm is that <i>x</i> will
	always be found in <i>c</i>, so the <b>foreach</b> never falls
	through the bottom of the code.
	There is no <b>return</b> at the close of the function, because
	that point is not reachable and any return statement would
	be dead code.
	This is perfectly legitimate code.
	The D compiler, to help with ensuring the robustness of such
	code, will ensure it is correct by automatically inserting
	an <i>assert(0);</i> statement at the close of the function.
	Then, if there's an error in the assumption that the <b>foreach</b> will
	never fall through, it will be caught at runtime with
	an obvious assertion failure, which is better than the code just
	falling off the end causing erratic, arbitrary failures.
	</p>

	<p>D's behavior on this, however, is not common to other languages,
	and some programmers will be acutely uncomfortable with relying
	on this, or they wish to see the error at compile time rather
	than runtime. They wish to see something explicit expressed in the
	source code that the <b>foreach</b> cannot fall through.
	Hence the warning.
	</p>

	<p>The warning can be resolved by:
	</p>

	<ol>	<li>Putting a return statement at the close of the function,
	returning some arbitrary value (after all, it will never be
	executed):

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> k, Collection c)
{
    <span class="d_keyword">foreach</span> (<span class="d_keyword">int</span> x; c)
    {
	<span class="d_keyword">if</span> (x == k)
	    <span class="d_keyword">return</span> x + 1;
    }
    <span class="d_keyword">return</span> 0;	<span class="d_comment">// suppress warning about no return statement
</span>}
</span></pre>

	While doing this is surprisingly common, and happens when
	the programmer is inexperienced or in a hurry, it is a
	spectacularly bad solution.
	The trouble happens when the <b>foreach</b> does fall through
	due to a bug, then instead of the bug being detected, now
	the function returns an unexpected value, which may cause other
	problems or go undetected.
	There's another issue with the maintenance programmer who
	sees this, and upon analyzing the code's behavior, wonders why
	there's a return statement that will never be executed.
	(This can be resolved with comments, but comments are always
	missing, out of date, or just plain wrong.)
	Dead code is always a confusing problem to maintenance programming,
	so deliberately inserting it is a bad idea.
	</li>

	<li>A better solution is to make explicit what the D language
	does implicitly - put an assert there:

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> k, Collection c)
{
    <span class="d_keyword">foreach</span> (<span class="d_keyword">int</span> x; c)
    {
	<span class="d_keyword">if</span> (x == k)
	    <span class="d_keyword">return</span> x + 1;
    }
    <span class="d_keyword">assert</span>(0);
}
</span></pre>

	Now, if the <b>foreach</b> does fall through, the error will be
	detected. Furthermore, it is self-documenting.
	</li>

	<li>Another alternative is to do a <b>throw</b> with a custom
	error class and a more user friendly message:

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> k, Collection c)
{
    <span class="d_keyword">foreach</span> (<span class="d_keyword">int</span> x; c)
    {
	<span class="d_keyword">if</span> (x == k)
	    <span class="d_keyword">return</span> x + 1;
    }
    <b><span class="d_keyword">throw</span></b> <span class="d_keyword">new</span> MyErrorClass(<span class="d_string">"fell off the end of foo()"</span>);
}
</span></pre>
	</li>
	</ol>

<h3>warning - switch statement has no default</h3>

	<p>Similar to the no return statement warning is the no default
	in a switch warning. Consider:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">switch</span> (i)
{
    <span class="d_keyword">case</span> 1: dothis(); <span class="d_keyword">break</span>;
    <span class="d_keyword">case</span> 2: dothat(); <span class="d_keyword">break</span>;
}
</span></pre>

	<p>According to the D language semantics, this means the only possible
	values for <i>i</i> are 1 and 2. Any other values represent a bug
	in the program. To detect this bug, the compiler implements the
	switch as if it were written:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">switch</span> (i)
{
    <span class="d_keyword">case</span> 1: dothis(); <span class="d_keyword">break</span>;
    <span class="d_keyword">case</span> 2: dothat(); <span class="d_keyword">break</span>;
    <b><span class="d_keyword">default</span>: <span class="d_keyword">throw</span> <span class="d_keyword">new</span> SwitchError();</b>
}
</span></pre>

	<p>This is quite different from C and C++ behavior, which is as if
	the switch were written:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">switch</span> (i)
{
    <span class="d_keyword">case</span> 1: dothis(); <span class="d_keyword">break</span>;
    <span class="d_keyword">case</span> 2: dothat(); <span class="d_keyword">break</span>;
    <b><span class="d_keyword">default</span>: <span class="d_keyword">break</span>;</b>
}
</span></pre>

	<p>The potential for bugs with that is high, as it is a common error
	to accidentally omit a case, or to add a new value in one part of
	the program and overlook adding a case for it in another part.
	Although D will catch this error at runtime by throwing
	an instance of <tt>std.switcherr.SwitchError</tt>, some prefer at least
	a warning so such errors can be caught at compile time.
	</p>

	<p>The warning can be resolved by:
	</p>

	<ol>	<li>Inserting an explict default of the form:

<pre class="d_code"><span class="notranslate"><span class="d_keyword">switch</span> (i)
{
    <span class="d_keyword">case</span> 1: dothis(); <span class="d_keyword">break</span>;
    <span class="d_keyword">case</span> 2: dothat(); <span class="d_keyword">break</span>;
    <b><span class="d_keyword">default</span>: <span class="d_keyword">assert</span>(0);</b>
}
</span></pre>
	</li>

	<li>As in the missing return, a default with a throw of a custom
	error class can be used.
	</li>
	</ol>

<h3>warning - statement is not reachable</h3>

	<p>Consider the following code:</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> i)
{
    <span class="d_keyword">return</span> i;
    <b><span class="d_keyword">return</span> i + 1;</b>
}
</span></pre>

	<p>The second return statement is not reachable, i.e. it is dead
	code. While dead code is poor style in released code, it can
	legitimately
	happen a lot when rapidly trying to isolate down a bug or experiment
	with different bits of code.
	</p>

	<p>The warning can be resolved by:
	</p>

	<ol>	<li>Commenting out the dead code with /+ ... +/ comments:
<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> i)
{
    <span class="d_keyword">return</span> i;
    <span class="d_comment">/+
	return i + 1;
     +/</span>
}
</span></pre>
	</li>

	<li>Putting the dead code inside a <tt>version(none)</tt> conditional:
<pre class="d_code"><span class="notranslate"><span class="d_keyword">int</span> foo(<span class="d_keyword">int</span> i)
{
    <span class="d_keyword">return</span> i;
    <b><span class="d_keyword">version</span> (none)</b>
    {
	<span class="d_keyword">return</span> i + 1;
    }
}
</span></pre>
	</li>

	<li>Only compile with warnings enabled when doing release builds.
	</li>
	</ol>


  
<div id="google_ad">
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
</div>



<div id="footernav">
<a href="http://www.digitalmars.com/NewsGroup.html" title="User Forums">Forums</a> |
<a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/Warnings" title="Read/write comments and feedback">Comments</a> |
<a href="index.html" title="D Programming Language" class="dlink">&nbsp;D&nbsp;</a> |
<a href="http://www.digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a> |
<a href="download.html" title="Download D">Downloads</a> |
<a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a>
</div>
<div id="copyright">

Copyright &copy; 1999-2011 by Digital Mars &reg;, All Rights Reserved |
Page generated by <a href="ddoc.html">Ddoc</a>.
</div>
</body>
</html>
